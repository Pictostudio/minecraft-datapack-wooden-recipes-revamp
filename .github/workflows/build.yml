name: Build Datapacks
on: 
  pull_request:
    branches:
      - main
    types:
      [closed]
permissions:
  contents: read
jobs:
  package:
    runs-on: ubuntu-latest
    if: github.event.pull_request.merged == true
    steps:
      - name: Checkout repository
        uses: actions/checkout@v6
      - name: Read datapack version
        run: |
          VERSION=$(cat VERSION)
          echo "VERSION=$VERSION" >> $GITHUB_ENV
          echo "Datapack version: $VERSION"
      - name: Create output folder
        run: mkdir -p output
      - name: Zip datapacks
        run: |
          for dir in wrr-*; do
            if [ -d "$dir" ]; then
              # Extract MC version from folder name
              # Folder format: wrr-<MC-Version>
              MC_VERSION=$(echo $dir | sed 's/wrr-//')
              zip -r "output/${dir}-${VERSION}.zip" "$dir"
              echo "Zipped $dir â†’ output/${dir}-${VERSION}.zip"
            fi
          done
      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: datapacks-v${{ env.VERSION }}
          path: output/*.zip